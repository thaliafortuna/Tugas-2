{% extends 'base.html' %}
{% block content %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <h4 style = "margin-top: 20px; text-align: center; margin-left: auto; margin-right:auto">Welcome, {{ user }}!</h3>
    <script>
      counter = 0
        function updateTable(){
        var tempCounter = counter;
        // AJAX GET, melakukan append data
        $.get("{% url 'todolist:json' %}", function(data) {
            for(var i = counter; i < data.length; i++){
                var tr = document.createElement("tr"); //row

                var thDate = document.createElement("th"); //data
                var thTitle = document.createElement("th"); //data                
                var thDescription = document.createElement("th"); //data
               
                
                thDate.append(data[i].fields.date);
                thTitle.append(data[i].fields.title);
                thDescription.append(data[i].fields.description);

                //append data to row
                tr.append(thDate);
                tr.append(thTitle);
                tr.append(thDescription);
                
                //append row to table
                $(".table").append(tr);
                tempCounter++;
            }
            counter = tempCounter;
          });
        }

        $(document).ready(function(){
          $("#get").click(function(){
            updateTable();
          });
        })
  
        
        $(document).on('submit', '#form_task', function(e){
          e.preventDefault();
          $.ajax({
            type:"POST",
            url:"{% url 'todolist:send' %}",
            data:{
              title:$("#title").val(),
              description:$("#description").val(),
              csrfmiddlewaretoken:'{{ csrf_token }}',
            },
            dataType: 'json',
            
            success: function(response) {
              updateTable();
              location.reload();
            },
          })
        });

      
    </script>
</head>

<!-- Button trigger modal -->
<div class="button">
<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Tambah Task Baru
</button>
<p><button class="btn btn-primary mt-5" id="get">Refresh</button></p>
</div>

<table class = "table" style = "text-align: center; margin-left: auto; margin-right:auto" class="table table-borderless">
    <tr>
    <th>Date</th>
    <th>Title</th>
    <th>Description</th>
    </tr>
</table>

<div class = "button">
<p><button class="btn btn-outline-light btn-warning px-3"><a href="{% url 'todolist:logout' %}">Logout</a></button></p>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Create New Task!</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" id = "form_task" action="">
          {% csrf_token %}
            <tr>
                <div class = "form-group">
                <h5>Task </h5>
                <input id="title" type="text" name="username" placeholder="Task" class="form-control">
                </div>
            </tr>
                    
            <tr>
                <div class = "form-group mt-3">
                <h5>Description </h5>
                <input id="description"type="description" name="password" placeholder="Description" class="form-control">
                </div>
            </tr>
            <div class="modal-footer">
              <button id = "submit" type="submit" class="btn btn-primary btn-sm" data-bs-dismiss="modal" >Add Task</button>
            </div>
      </form>
      </div>
    </div>
  </div>
</div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@700&family=Poppins:wght@400;500;600&display=swap');
  *{
      box-sizing: border-box;
      font-family: "Poppins"
  }
  body{
      min-height: 100vh;
  } button{
    margin: 0;
    position: absolute;
    left: 50%;
    -ms-transform: translateX(-50%);
    transform: translateX(-50%);
  } table{
    margin-top: 120px;
  } 
</style>

{% endblock content %}